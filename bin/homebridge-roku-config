#!/usr/bin/env node

const discover = require('nodeku')

discover().then(device => {
  const ip = device.ip();
  const appMap = {};
  return device.apps().then(apps =>
    apps.forEach(app => appMap[app.name] = app.id))
  .then(() => device.info())
  .then(info => ({ ip, appMap, info }))
})
.then(({ ip, appMap, info }) => {
  const config = {
    accessories: [
      {
        accessory: "Roku",
        name: "Roku",
        ip,
        appMap,
        info,
      },
    ],
  };

  console.log(JSON.stringify(config, null, 4));
})
.catch(err => {
  console.error(err.stack)
});

